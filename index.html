<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>Gerador de Volumes - QRCODE</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript" src="qrcode.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<link rel="stylesheet" href="https://printjs-4de6.kxcdn.com/print.min.css" />
	<script src="https://printjs-4de6.kxcdn.com/print.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/js/materialize.min.js"></script>
	<style type="text/css" media="screen">
	.centralizado{
		width: 50%;
		height:100%;
		margin:40px  auto;
	}
	.hello{
		margin-bottom: 20px;
	}
	button{
		width: 100%;
	}


	
</style>
</head>

<body>
	<div class="navbar-fixed">
		<nav style="background-color: gray">
			<div class="nav-wrapper">

				<a href="#" class="brand-logo center">QR CODE</a>


			</div>
		</nav>
	</div>
	<div class="container">
		<div class="centralizado z-depth-5">
			<div class="row">
				<div class="col s12 m6">
					<div class="input-field inline">
						<input id="item" type="number">
						<label for="item">Item </label>		            
					</div>

				</div>
				<div class="col s12 m6">
					<div class="input-field inline">
						<input id="lote" type="number" required>
						<label for="lote">Lote </label>
					</div>
				</div>
				<div class="col s12">
					<div class="input-field">
						<input id="quantidade" type="number"  required>
						<label for="quantidade">Quantidade</label>
					</div>

					
					<table  class="responsive-table striped">

						<tbody>
							<tr>
								<td>				
									<label>
										<input type="checkbox" class="volumes" value="01"/>
										<span>01</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="02" />
										<span>02</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="03"/>
										<span>03</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="04"/>
										<span>04</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="05" />
										<span>05</span>
									</label>
								</td>
							</tr>
							<tr>
								<td>				
									<label>
										<input type="checkbox" class="volumes" value="06" />
										<span>06</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="07"/>
										<span>07</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="08"/>
										<span>08</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="09"/>
										<span>09</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="10"/>
										<span>10</span>
									</label>
								</td>
							</tr>
							<tr>
								<td>				
									<label>
										<input type="checkbox" class="volumes" value="11"/>
										<span>11</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="12" />
										<span>12</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="13" />
										<span>13</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="14" />
										<span>14</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="15" />
										<span>15</span>
									</label>
								</td>
							</tr>
							<tr>
								<td>				
									<label>
										<input type="checkbox" class="volumes" value="16" />
										<span>16</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="17" />
										<span>17</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="18" />
										<span>18</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="19" />
										<span>19</span>
									</label>
								</td>
								<td>
									<label>
										<input type="checkbox" class="volumes" value="20"/>
										<span>20</span>
									</label>
								</td>
							</tr>

						</tbody>
					</table>

					<hr />

					<button data-target="modal1" id="toActive" disabled onclick="somar()" class="btn modal-trigger">Gerar Etiquetas</button>
				</div>
			</div>
			<div id="modal1" class="modal modal-fixed-footer">
				<div id="modal-content" class="modal-content">
					<h1 id="p_lote"></h1>
					<h3 id="p_quantidade"></h3>
					<div id="dep"></div>
				</div>
				<div class="modal-footer">
					<div class="row">
						<div class="col s6">
							<button  class="btn modal-trigger" onclick="dismiss()">Cancelar</button>
						</div>
						<div class="col s6">
							<button onclick="imprimir()" class="btn modal-trigger">Imprimir</button>	
						</div>
					</div>	      
				</div>
			</div>
			<div id="test"></div>



		</div>
	</div>

</div>


</div>


<script type="text/javascript">

	var todos = [];
	var fieldItem = false;
	var fieldLote = false;

	var item = "";
	var lote ="";
	var quantidade="";
	var volumes="";

	function dismiss(){
		$('.modal').modal({dismissible: true});
		var volumes =  document.querySelectorAll(".volumes");

		document.getElementById('item').value = "";
		document.getElementById('lote').value ="";
		document.getElementById('quantidade').value ="";
		for(var i=0;i<volumes.length;i++){
			volumes[i].checked = false;
		}
		location.reload();
	}
	
	function imprimir(){
		printJS({ printable: 'modal-content', type: 'html', header: 'Volumes ' });
		dismiss();
	}
	function somar(){
		todos = [];
		item="";
		quantidade="";
		lote="";
		volumes =  document.querySelectorAll(".volumes");
		item =  document.getElementById('item').value;
		lote =  document.getElementById('lote').value;
		quantidade =  document.getElementById('quantidade').value;

		for(var i=0;i<volumes.length;i++){
			if(volumes[i].checked){
				todos.push(volumes[i].value);
			}

		}
		qtdeVolume = quantidade / todos.length;
		etParcial = Math.ceil(qtdeVolume);
		etFinal = quantidade - (etParcial * (todos.length-1));
		fixTag(etParcial);
		for(var i=0;i<todos.length;i++){

			if(i != todos.length-1){
				etiqueta = fixTag(etParcial,10);
				nVolume = fixTag(todos[i],4);
			}
			else{
				etiqueta = fixTag(etFinal,10);
				nVolume = fixTag(todos[i],4);
			}

		}
		makeCode(item,lote,etParcial,etFinal,todos);
	}
	function fixTag(valor,unit){
		caracteres = valor.toString().length;
		val="";
		for (var i=0;i< unit-caracteres ;i++){
			val+="0";
		}
		return val+valor;
	}
	function makeCode (item,lote,parcial,final,volumes) {
		var el = [];
		for(var i=0;i<volumes.length;i++){

			var div = document.createElement('div');
			div.setAttribute('id','qr_code_'+i);
			div.setAttribute('class','hello');
			document.getElementById("dep").appendChild(div);
			el.push(new QRCode(document.getElementById("qr_code_"+i), {
				width : 100,
				height : 100
			}));
		}

		for(var i=0;i<el.length;i++){
			if(i != volumes[i]-1){
				el[i].makeCode("01"+item+lote+parcial+volumes[i]);			
			}else{
				el[i].makeCode("01"+item+lote+final+volumes[i]);
			}

		}
		document.getElementById('p_lote').innerHTML = "Lote : "+lote;
		document.getElementById('p_quantidade').innerHTML = "Quantidade : "+quantidade;


	}


	function turnOnBtn(){

		var x = document.getElementById('quantidade').value > 0 ? true : false;
		if(fieldItem && fieldLote && x){
			document.getElementById('toActive').disabled = false;
		}
		else
		{
			document.getElementById('toActive').disabled = true;
		}

	}
	$(document).ready(function(){
		$('.modal').modal({dismissible: false});
		
		var optionsItem =  {
			onComplete: function(cep) {
				fieldItem = true;
				turnOnBtn();
				
			},
			onKeyPress: function(cep, event, currentField, options){
				console.log(cep.length);
			},
			onChange: function(cep){
				if(cep.length < 7 ){
					fieldItem = false;
					turnOnBtn();

				}
			},
			onInvalid: function(val, e, f, invalid, options){
				var error = invalid[0];
				console.log ("Digit: ", error.v, " is invalid for the position: ", error.p, ". We expect something like: ", error.e);
			}
		};
		var optionsLote =  {
			onComplete: function(cep) {
				fieldLote = true;
				turnOnBtn();				
			},
			onKeyPress: function(cep, event, currentField, options){
				console.log(cep.length);
			},
			onChange: function(cep){
				if(cep.length < 8 ){
					fieldLote = false;
					turnOnBtn();

				}
			},
			onInvalid: function(val, e, f, invalid, options){
				var error = invalid[0];
				console.log ("Digit: ", error.v, " is invalid for the position: ", error.p, ". We expect something like: ", error.e);
			}
		};

		$('#item').mask('00.0000', optionsItem);
		$('#lote').mask('00000000', optionsLote);
		$("#quantidade").bind('keyup mouseup', function () {
			turnOnBtn();            
		});
		

	});


</script>
</body>